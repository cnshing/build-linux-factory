name: 'build-linux-factory'
description: 'Builds an image from a linux factory'
inputs:
  factory-dir:
    description: 'Root directory of the linux factory'
    required: true
runs:
  using: 'composite'
  steps:
    # Modified from https://github.com/addnab/docker-run-action
  - name: Checkout 
    uses: actions/checkout@v2 # Required to mount the Github Workspace to a volume 

  - uses: addnab/docker-run-action@v3
    with:
      shell: bash
      image: cnshing/build-linux-factory:v1
      options: --privileged -v ${{ github.workspace }}:/work
      run: |
        echo "."
        ls .
        echo "work"
        ls /work
        echo "/"
        ls /
        echo "$GITHUB_WORKSPACE <-"
        ls $GITHUB_WORKSPACE
        echo "Attempting to find entrypoint.sh..."
        find -name / "entrypoint.sh"
        /entrypoint.sh ${{ inputs.factory-dir }}